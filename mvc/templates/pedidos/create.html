<div class="panel panel-primary">
    <div class="panel-heading">
        <h3 class="panel-title">Filtros</h3>
    </div>
    <div class="panel-body">
        <form class="form-inline" name="frmFiltroPedido" method="POST" role="form">
            <div class="form-group">
                <label class="sr-only" for="ddlCarrera">Carreras</label>
                <select id="ddlCarrera" class="form-control" name="ddlCarrera">
                    <option selected="selected" disabled="disabled">Carrera</option>
                    {combo_carrera}
                </select>
            </div>
            <div class="form-group">
                <label class="sr-only" for="ddlNivel">Niveles</label>
                <select id="ddlNivel" class="form-control" name="ddlNivel">
                    <option selected="selected" disabled="disabled">Nivel</option>
                    {combo_nivel}
                </select>
            </div>
            <div class="form-group">
                <label class="sr-only" for="ddlMateria">Materias</label>
                <select id="ddlMateria" class="form-control" name="ddlMateria">
                    <option selected="selected" disabled="disabled">Materias</option>
                    {combo_materia}
                </select>
            </div>
            <button id="btnFiltrar" class="btn btn-success" type="submit">Filtrar</button>
        </form>
    </div>
</div>
<div class="panel panel-primary">
    <div class="panel-heading">
        <h3 class="panel-title">Resultados</h3>
    </div>
    <div class="panel-body">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Codigo</th>
                    <th>Titulo</th>
                    <th>Autor</th>
                    <th>Docente</th>
                    <th>Paginas</th>
                    <th>Precio</th>
                    <th>Agregar</th>
                </tr>
            </thead>
            <tbody>
                {table_content}
            </tbody>
        </table>
    </div>
</div>
<script type="text/javascript">
    // Desactivo los controles al principio para despues habilitarlos.
    $('#ddlNivel').attr('disabled', true);
    $('#ddlMateria').attr('disabled', true);
    
    $('#ddlCarrera').change(function() {
        $.ajax({
            type: 'POST',
            url: './ajax_get_niveles',
            data: 'idCarrera=' + $('#ddlCarrera').val(),
            success: function (data, textStatus, jqXHR) {
                // Limpio los DDL foraneos.
                $('#ddlNivel').empty();
                $('#ddlNivel').append($('<option>').text('Niveles').attr('disabled', true));
                $('#ddlMateria').empty();
                $('#ddlMateria').append($('<option>').text('Materias').attr('disabled', true));
                
                // Parseo el JSON y agrego los datos en el DLL
                $.parseJSON(data).map(function(value, key) {
                    $('#ddlNivel').append($('<option>').val(value.IdNivel).text(value.Descripcion));
                });
                
                // Habilito el DDL hijo.
                $('#ddlNivel').removeAttr('disabled');
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert('error');
            }
        });
    });
    
    $('#ddlNivel').change(function() {
        $.ajax({
            type: 'POST',
            url: './ajax_get_materias',
            data: 'idNivel=' + $('#ddlNivel').val(),
            success: function (data, textStatus, jqXHR) {
                // Limpio el DDL foraneo,
                $('#ddlMateria').empty();
                $('#ddlMateria').append($('<option>').text('Materias').attr('disabled', true));
                
                // Parseo el JSON y agrego los items al DDL.s
                $.parseJSON(data).map(function(value) {
                    $('#ddlMateria').append($('<option>').val(value.IdMateria).text(value.Descripcion));
                });
                
                // Habilito el DDL hijo.
                $('#ddlMateria').removeAttr('disabled');
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert('error');
            }
        });
    });
</script>